var NetlessAppTalkative=function(x){"use strict";var ut=Object.defineProperty;var lt=(x,_,B)=>_ in x?ut(x,_,{enumerable:!0,configurable:!0,writable:!0,value:B}):x[_]=B;var Y=(x,_,B)=>(lt(x,typeof _!="symbol"?_+"":_,B),B);var _="!#%()*+,-./:;=?@[]^_`{|}~ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",B=87,ke=20,se=[],Te=()=>{for(let e=0;e<ke;e++)se[e]=_.charAt(Math.random()*B);return se.join("")};function ae(e){try{return e()}catch(t){console.error(t)}}var X=class{constructor(){this.push=this.addDisposer,this.disposers=new Map}addDisposer(e,t=this.genUID()){return this.flush(t),this.disposers.set(t,Array.isArray(e)?Oe(e):e),t}add(e,t=this.genUID()){const r=e();return r?this.addDisposer(r,t):t}addEventListener(e,t,r,a,o=this.genUID()){return e.addEventListener(t,r,a),this.addDisposer(()=>e.removeEventListener(t,r,a),o),o}setTimeout(e,t,r=this.genUID()){const a=window.setTimeout(()=>{this.remove(r),e()},t);return this.addDisposer(()=>window.clearTimeout(a),r)}setInterval(e,t,r=this.genUID()){const a=window.setInterval(e,t);return this.addDisposer(()=>window.clearInterval(a),r)}remove(e){const t=this.disposers.get(e);return this.disposers.delete(e),t}flush(e){const t=this.remove(e);t&&t()}flushAll(){this.disposers.forEach(ae),this.disposers.clear()}genUID(){let e;do e=Te();while(this.disposers.has(e));return e}};function Oe(e){return()=>e.forEach(ae)}var ze=typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{},ee={exports:{}};(function(e,t){(function(r,a){{var o=a();e&&e.exports&&(t=e.exports=o),t.randomColor=o}})(ze,function(){var r=null,a={};F();var o=[],u=function(n){if(n=n||{},n.seed!==void 0&&n.seed!==null&&n.seed===parseInt(n.seed,10))r=n.seed;else if(typeof n.seed=="string")r=M(n.seed);else{if(n.seed!==void 0&&n.seed!==null)throw new TypeError("The seed value must be an integer or string");r=null}var i,s,c;if(n.count!==null&&n.count!==void 0){for(var d=n.count,h=[],f=0;f<n.count;f++)o.push(!1);for(n.count=null;d>h.length;){var z=u(n);r!==null&&(n.seed=r),h.push(z)}return n.count=d,h}return i=l(n),s=v(i,n),c=y(i,s,n),m([i,s,c],n)};function l(n){if(o.length>0){var i=H(n.hue),s=R(i),c=(i[1]-i[0])/o.length,d=parseInt((s-i[0])/c);o[d]===!0?d=(d+2)%o.length:o[d]=!0;var h=(i[0]+d*c)%359,f=(i[0]+(d+1)*c)%359;return i=[h,f],s=R(i),s<0&&(s=360+s),s}else{var i=b(n.hue);return s=R(i),s<0&&(s=360+s),s}}function v(n,i){if(i.hue==="monochrome")return 0;if(i.luminosity==="random")return R([0,100]);var s=$(n),c=s[0],d=s[1];switch(i.luminosity){case"bright":c=55;break;case"dark":c=d-10;break;case"light":d=55;break}return R([c,d])}function y(n,i,s){var c=S(n,i),d=100;switch(s.luminosity){case"dark":d=c+20;break;case"light":c=(d+c)/2;break;case"random":c=0,d=100;break}return R([c,d])}function m(n,i){switch(i.format){case"hsvArray":return n;case"hslArray":return E(n);case"hsl":var s=E(n);return"hsl("+s[0]+", "+s[1]+"%, "+s[2]+"%)";case"hsla":var c=E(n),f=i.alpha||Math.random();return"hsla("+c[0]+", "+c[1]+"%, "+c[2]+"%, "+f+")";case"rgbArray":return O(n);case"rgb":var d=O(n);return"rgb("+d.join(", ")+")";case"rgba":var h=O(n),f=i.alpha||Math.random();return"rgba("+h.join(", ")+", "+f+")";default:return W(n)}}function S(n,i){for(var s=p(n).lowerBounds,c=0;c<s.length-1;c++){var d=s[c][0],h=s[c][1],f=s[c+1][0],z=s[c+1][1];if(i>=d&&i<=f){var N=(z-h)/(f-d),k=h-N*d;return N*i+k}}return 0}function b(n){if(typeof parseInt(n)=="number"){var i=parseInt(n);if(i<360&&i>0)return[i,i]}if(typeof n=="string"){if(a[n]){var s=a[n];if(s.hueRange)return s.hueRange}else if(n.match(/^#?([0-9A-F]{3}|[0-9A-F]{6})$/i)){var c=g(n)[0];return[c,c]}}return[0,360]}function $(n){return p(n).saturationRange}function p(n){n>=334&&n<=360&&(n-=360);for(var i in a){var s=a[i];if(s.hueRange&&n>=s.hueRange[0]&&n<=s.hueRange[1])return a[i]}return"Color not found"}function R(n){if(r===null){var i=.618033988749895,s=Math.random();return s+=i,s%=1,Math.floor(n[0]+s*(n[1]+1-n[0]))}else{var c=n[1]||1,d=n[0]||0;r=(r*9301+49297)%233280;var h=r/233280;return Math.floor(d+h*(c-d))}}function W(n){var i=O(n);function s(d){var h=d.toString(16);return h.length==1?"0"+h:h}var c="#"+s(i[0])+s(i[1])+s(i[2]);return c}function w(n,i,s){var c=s[0][0],d=s[s.length-1][0],h=s[s.length-1][1],f=s[0][1];a[n]={hueRange:i,lowerBounds:s,saturationRange:[c,d],brightnessRange:[h,f]}}function F(){w("monochrome",null,[[0,0],[100,0]]),w("red",[-26,18],[[20,100],[30,92],[40,89],[50,85],[60,78],[70,70],[80,60],[90,55],[100,50]]),w("orange",[18,46],[[20,100],[30,93],[40,88],[50,86],[60,85],[70,70],[100,70]]),w("yellow",[46,62],[[25,100],[40,94],[50,89],[60,86],[70,84],[80,82],[90,80],[100,75]]),w("green",[62,178],[[30,100],[40,90],[50,85],[60,81],[70,74],[80,64],[90,50],[100,40]]),w("blue",[178,257],[[20,100],[30,86],[40,80],[50,74],[60,60],[70,52],[80,44],[90,39],[100,35]]),w("purple",[257,282],[[20,100],[30,87],[40,79],[50,70],[60,65],[70,59],[80,52],[90,45],[100,42]]),w("pink",[282,334],[[20,100],[30,90],[40,86],[60,84],[80,80],[90,75],[100,73]])}function O(n){var i=n[0];i===0&&(i=1),i===360&&(i=359),i=i/360;var s=n[1]/100,c=n[2]/100,d=Math.floor(i*6),h=i*6-d,f=c*(1-s),z=c*(1-h*s),N=c*(1-(1-h)*s),k=256,A=256,D=256;switch(d){case 0:k=c,A=N,D=f;break;case 1:k=z,A=c,D=f;break;case 2:k=f,A=c,D=N;break;case 3:k=f,A=z,D=c;break;case 4:k=N,A=f,D=c;break;case 5:k=c,A=f,D=z;break}var dt=[Math.floor(k*255),Math.floor(A*255),Math.floor(D*255)];return dt}function g(n){n=n.replace(/^#/,""),n=n.length===3?n.replace(/(.)/g,"$1$1"):n;var i=parseInt(n.substr(0,2),16)/255,s=parseInt(n.substr(2,2),16)/255,c=parseInt(n.substr(4,2),16)/255,d=Math.max(i,s,c),h=d-Math.min(i,s,c),f=d?h/d:0;switch(d){case i:return[60*((s-c)/h%6)||0,f,d];case s:return[60*((c-i)/h+2)||0,f,d];case c:return[60*((i-s)/h+4)||0,f,d]}}function E(n){var i=n[0],s=n[1]/100,c=n[2]/100,d=(2-s)*c;return[i,Math.round(s*c/(d<1?d:2-d)*1e4)/100,d/2*100]}function M(n){for(var i=0,s=0;s!==n.length&&!(i>=Number.MAX_SAFE_INTEGER);s++)i+=n.charCodeAt(s);return i}function H(n){if(isNaN(n)){if(typeof n=="string"){if(a[n]){var s=a[n];if(s.hueRange)return s.hueRange}else if(n.match(/^#?([0-9A-F]{3}|[0-9A-F]{6})$/i)){var c=g(n)[0];return p(c).hueRange}}}else{var i=parseInt(n);if(i<360&&i>0)return p(n).hueRange}return[0,360]}return u})})(ee,ee.exports);var xe=ee.exports;class _e{constructor(t="NetlessApp",r="error"){Y(this,"kind");Y(this,"debug");Y(this,"color",xe({luminosity:"dark"}));this.kind=t,this.debug=r}log(...t){if(this.debug===!0||this.debug==="log")return this._log("log",t)}warn(...t){if(this.debug&&this.debug!=="error")return this._log("warn",t)}error(...t){if(this.debug)return this._log("error",t)}_log(t,r){console[t](`%c[${this.kind}]:`,`color: ${this.color}; font-weight: bold;`,...r)}}function $e(e){var m;const t=e.getRoom(),r=e.getDisplayer(),a=r.observerId,o=(m=r.state.roomMembers.find(S=>S.memberId===a))==null?void 0:m.payload,u=(o==null?void 0:o.uid)||(t==null?void 0:t.uid)||"",l=(o==null?void 0:o.nickName)||u,v=(o==null?void 0:o.userId)||u,y=(o==null?void 0:o.cursorName)||l||"";return{memberId:a,uid:u,userId:v,nickName:l,cursorName:y}}function Me(e){const t=e.indexOf("?",1);return t!==-1?{search:e.slice(t),pathname:e.slice(0,t)}:{search:"",pathname:e}}function Be(e,t){const{pathname:r,search:a}=Me(e);return r+(a?`${a}&`:"?")+t}function I(e){return document.createElement(e)}function V(e,t,r){r==null?e.removeAttribute(t):e.setAttribute(t,r)}function G(e,t){return e.appendChild(t)}function oe(e){var t;return(t=e.parentNode)==null?void 0:t.removeChild(e)}const ce=Promise.resolve();function q(e){const t=[];return{get value(){return e},set(r){e=r,t.forEach(a=>a(e))},subscribe(r){return t.push(r),ce.then(()=>r(e)),()=>{t.splice(t.indexOf(r),1)}}}}var C=[],Ce=function(){return C.some(function(e){return e.activeTargets.length>0})},Le=function(){return C.some(function(e){return e.skippedTargets.length>0})},de="ResizeObserver loop completed with undelivered notifications.",Ne=function(){var e;typeof ErrorEvent=="function"?e=new ErrorEvent("error",{message:de}):(e=document.createEvent("Event"),e.initEvent("error",!1,!1),e.message=de),window.dispatchEvent(e)},U;(function(e){e.BORDER_BOX="border-box",e.CONTENT_BOX="content-box",e.DEVICE_PIXEL_CONTENT_BOX="device-pixel-content-box"})(U||(U={}));var L=function(e){return Object.freeze(e)},Ae=function(){function e(t,r){this.inlineSize=t,this.blockSize=r,L(this)}return e}(),ue=function(){function e(t,r,a,o){return this.x=t,this.y=r,this.width=a,this.height=o,this.top=this.y,this.left=this.x,this.bottom=this.top+this.height,this.right=this.left+this.width,L(this)}return e.prototype.toJSON=function(){var t=this,r=t.x,a=t.y,o=t.top,u=t.right,l=t.bottom,v=t.left,y=t.width,m=t.height;return{x:r,y:a,top:o,right:u,bottom:l,left:v,width:y,height:m}},e.fromRect=function(t){return new e(t.x,t.y,t.width,t.height)},e}(),te=function(e){return e instanceof SVGElement&&"getBBox"in e},le=function(e){if(te(e)){var t=e.getBBox(),r=t.width,a=t.height;return!r&&!a}var o=e,u=o.offsetWidth,l=o.offsetHeight;return!(u||l||e.getClientRects().length)},he=function(e){var t;if(e instanceof Element)return!0;var r=(t=e==null?void 0:e.ownerDocument)===null||t===void 0?void 0:t.defaultView;return!!(r&&e instanceof r.Element)},De=function(e){switch(e.tagName){case"INPUT":if(e.type!=="image")break;case"VIDEO":case"AUDIO":case"EMBED":case"OBJECT":case"CANVAS":case"IFRAME":case"IMG":return!0}return!1},J=typeof window!="undefined"?window:{},j=new WeakMap,fe=/auto|scroll/,Ie=/^tb|vertical/,Pe=/msie|trident/i.test(J.navigator&&J.navigator.userAgent),T=function(e){return parseFloat(e||"0")},P=function(e,t,r){return e===void 0&&(e=0),t===void 0&&(t=0),r===void 0&&(r=!1),new Ae((r?t:e)||0,(r?e:t)||0)},ve=L({devicePixelContentBoxSize:P(),borderBoxSize:P(),contentBoxSize:P(),contentRect:new ue(0,0,0,0)}),pe=function(e,t){if(t===void 0&&(t=!1),j.has(e)&&!t)return j.get(e);if(le(e))return j.set(e,ve),ve;var r=getComputedStyle(e),a=te(e)&&e.ownerSVGElement&&e.getBBox(),o=!Pe&&r.boxSizing==="border-box",u=Ie.test(r.writingMode||""),l=!a&&fe.test(r.overflowY||""),v=!a&&fe.test(r.overflowX||""),y=a?0:T(r.paddingTop),m=a?0:T(r.paddingRight),S=a?0:T(r.paddingBottom),b=a?0:T(r.paddingLeft),$=a?0:T(r.borderTopWidth),p=a?0:T(r.borderRightWidth),R=a?0:T(r.borderBottomWidth),W=a?0:T(r.borderLeftWidth),w=b+m,F=y+S,O=W+p,g=$+R,E=v?e.offsetHeight-g-e.clientHeight:0,M=l?e.offsetWidth-O-e.clientWidth:0,H=o?w+O:0,n=o?F+g:0,i=a?a.width:T(r.width)-H-M,s=a?a.height:T(r.height)-n-E,c=i+w+M+O,d=s+F+E+g,h=L({devicePixelContentBoxSize:P(Math.round(i*devicePixelRatio),Math.round(s*devicePixelRatio),u),borderBoxSize:P(c,d,u),contentBoxSize:P(i,s,u),contentRect:new ue(b,y,i,s)});return j.set(e,h),h},ge=function(e,t,r){var a=pe(e,r),o=a.borderBoxSize,u=a.contentBoxSize,l=a.devicePixelContentBoxSize;switch(t){case U.DEVICE_PIXEL_CONTENT_BOX:return l;case U.BORDER_BOX:return o;default:return u}},We=function(){function e(t){var r=pe(t);this.target=t,this.contentRect=r.contentRect,this.borderBoxSize=L([r.borderBoxSize]),this.contentBoxSize=L([r.contentBoxSize]),this.devicePixelContentBoxSize=L([r.devicePixelContentBoxSize])}return e}(),be=function(e){if(le(e))return 1/0;for(var t=0,r=e.parentNode;r;)t+=1,r=r.parentNode;return t},Fe=function(){var e=1/0,t=[];C.forEach(function(l){if(l.activeTargets.length!==0){var v=[];l.activeTargets.forEach(function(m){var S=new We(m.target),b=be(m.target);v.push(S),m.lastReportedSize=ge(m.target,m.observedBox),b<e&&(e=b)}),t.push(function(){l.callback.call(l.observer,v,l.observer)}),l.activeTargets.splice(0,l.activeTargets.length)}});for(var r=0,a=t;r<a.length;r++){var o=a[r];o()}return e},me=function(e){C.forEach(function(r){r.activeTargets.splice(0,r.activeTargets.length),r.skippedTargets.splice(0,r.skippedTargets.length),r.observationTargets.forEach(function(o){o.isActive()&&(be(o.target)>e?r.activeTargets.push(o):r.skippedTargets.push(o))})})},He=function(){var e=0;for(me(e);Ce();)e=Fe(),me(e);return Le()&&Ne(),e>0},re,we=[],Ve=function(){return we.splice(0).forEach(function(e){return e()})},Ue=function(e){if(!re){var t=0,r=document.createTextNode(""),a={characterData:!0};new MutationObserver(function(){return Ve()}).observe(r,a),re=function(){r.textContent="".concat(t?t--:t++)}}we.push(e),re()},Je=function(e){Ue(function(){requestAnimationFrame(e)})},Z=0,Xe=function(){return!!Z},Ge=250,qe={attributes:!0,characterData:!0,childList:!0,subtree:!0},ye=["resize","load","transitionend","animationend","animationstart","animationiteration","keyup","keydown","mouseup","mousedown","mouseover","mouseout","blur","focus"],Se=function(e){return e===void 0&&(e=0),Date.now()+e},ne=!1,je=function(){function e(){var t=this;this.stopped=!0,this.listener=function(){return t.schedule()}}return e.prototype.run=function(t){var r=this;if(t===void 0&&(t=Ge),!ne){ne=!0;var a=Se(t);Je(function(){var o=!1;try{o=He()}finally{if(ne=!1,t=a-Se(),!Xe())return;o?r.run(1e3):t>0?r.run(t):r.start()}})}},e.prototype.schedule=function(){this.stop(),this.run()},e.prototype.observe=function(){var t=this,r=function(){return t.observer&&t.observer.observe(document.body,qe)};document.body?r():J.addEventListener("DOMContentLoaded",r)},e.prototype.start=function(){var t=this;this.stopped&&(this.stopped=!1,this.observer=new MutationObserver(this.listener),this.observe(),ye.forEach(function(r){return J.addEventListener(r,t.listener,!0)}))},e.prototype.stop=function(){var t=this;this.stopped||(this.observer&&this.observer.disconnect(),ye.forEach(function(r){return J.removeEventListener(r,t.listener,!0)}),this.stopped=!0)},e}(),ie=new je,Re=function(e){!Z&&e>0&&ie.start(),Z+=e,!Z&&ie.stop()},Ze=function(e){return!te(e)&&!De(e)&&getComputedStyle(e).display==="inline"},Ke=function(){function e(t,r){this.target=t,this.observedBox=r||U.CONTENT_BOX,this.lastReportedSize={inlineSize:0,blockSize:0}}return e.prototype.isActive=function(){var t=ge(this.target,this.observedBox,!0);return Ze(this.target)&&(this.lastReportedSize=t),this.lastReportedSize.inlineSize!==t.inlineSize||this.lastReportedSize.blockSize!==t.blockSize},e}(),Qe=function(){function e(t,r){this.activeTargets=[],this.skippedTargets=[],this.observationTargets=[],this.observer=t,this.callback=r}return e}(),K=new WeakMap,Ee=function(e,t){for(var r=0;r<e.length;r+=1)if(e[r].target===t)return r;return-1},Q=function(){function e(){}return e.connect=function(t,r){var a=new Qe(t,r);K.set(t,a)},e.observe=function(t,r,a){var o=K.get(t),u=o.observationTargets.length===0;Ee(o.observationTargets,r)<0&&(u&&C.push(o),o.observationTargets.push(new Ke(r,a&&a.box)),Re(1),ie.schedule())},e.unobserve=function(t,r){var a=K.get(t),o=Ee(a.observationTargets,r),u=a.observationTargets.length===1;o>=0&&(u&&C.splice(C.indexOf(a),1),a.observationTargets.splice(o,1),Re(-1))},e.disconnect=function(t){var r=this,a=K.get(t);a.observationTargets.slice().forEach(function(o){return r.unobserve(t,o.target)}),a.activeTargets.splice(0,a.activeTargets.length)},e}(),Ye=function(){function e(t){if(arguments.length===0)throw new TypeError("Failed to construct 'ResizeObserver': 1 argument required, but only 0 present.");if(typeof t!="function")throw new TypeError("Failed to construct 'ResizeObserver': The callback provided as parameter 1 is not a function.");Q.connect(this,t)}return e.prototype.observe=function(t,r){if(arguments.length===0)throw new TypeError("Failed to execute 'observe' on 'ResizeObserver': 1 argument required, but only 0 present.");if(!he(t))throw new TypeError("Failed to execute 'observe' on 'ResizeObserver': parameter 1 is not of type 'Element");Q.observe(this,t,r)},e.prototype.unobserve=function(t){if(arguments.length===0)throw new TypeError("Failed to execute 'unobserve' on 'ResizeObserver': 1 argument required, but only 0 present.");if(!he(t))throw new TypeError("Failed to execute 'unobserve' on 'ResizeObserver': parameter 1 is not of type 'Element");Q.unobserve(this,t)},e.prototype.disconnect=function(){Q.disconnect(this)},e.toString=function(){return"function ResizeObserver () { [polyfill code] }"},e}(),et=`.app-talkative-container{width:100%;height:100%;overflow:hidden;display:flex;justify-content:center;align-items:center;flex-direction:column}.app-talkative-container iframe{width:100%;height:100%;border:none;display:block}.app-talkative-footer{box-sizing:border-box;height:40px;display:flex;align-items:center;padding:0 16px;color:#191919;background:#ebecfa;justify-content:center}.app-talkative-footer>span{font-size:14px;color:#8d8fa6;user-select:none;white-space:nowrap;word-break:keep-all}.app-talkative-page{font-variant-numeric:tabular-nums}.app-talkative-btn{box-sizing:border-box;width:26px;height:26px;font-size:0;margin:0;padding:3px;border:none;border-radius:4px;outline:none;color:currentColor;background:transparent;transition:background .4s;cursor:pointer;user-select:none;-webkit-tap-highlight-color:rgba(0,0,0,0);color:#8d8fa6}.app-talkative-btn:hover{background-color:#1b1f4d0a}@media (hover: none){.app-talkative-btn:hover{background:transparent!important}}.app-talkative-btn .arrow{fill:#8d8fa6}.app-talkative-btn>svg{width:100%;height:100%}.app-talkative-btn>svg:nth-of-type(2){display:none}.app-talkative-footer-btn-disable{color:#c6c7d2;cursor:not-allowed}.app-talkative-footer-btn-disable .arrow{fill:#c6c7d2}.telebox-color-scheme-dark .app-talkative-container{color:#eee}
`;const tt=window.ResizeObserver||Ye;class rt{constructor(t){this.context=t,this.sideEffect=new X,this.role=q(2),this.ratio=q(1.7777777777777777),this.$content=I("div"),this.$iframe=I("iframe"),this.box=t.getBox(),V(this.$content,"class","app-talkative-container"),G(this.$content,this.$iframe),this.$content.dataset.appKind="Talkative"}_on_update_role(t){this.$content.dataset.role=String(t),this.$content.classList.toggle("owner",t===0)}_on_update_ratio(t,r){const{width:a,height:o}=r?r.contentRect:this.$content.getBoundingClientRect();a/t>o?this.$iframe.style.height="":a/t<o&&(this.$iframe.style.width="")}_observe_content_resize(){const t=new tt(r=>{this._on_update_ratio(this.ratio.value,r[0])});return t.observe(this.$content),t.disconnect.bind(t)}mount(){return this.box.mountStyles(et),this.box.mountContent(this.$content),this.sideEffect.addDisposer(this.role.subscribe(this._on_update_role.bind(this))),this.sideEffect.addDisposer(this.ratio.subscribe(this._on_update_ratio.bind(this))),this.sideEffect.addDisposer(this._observe_content_resize()),this.destroy.bind(this)}destroy(){this.sideEffect.flushAll(),oe(this.$content)}postMessage(t){var r;console.log(t),(r=this.$iframe.contentWindow)==null||r.postMessage(t,"*")}}function nt(e){const t="http://www.w3.org/2000/svg",r=document.createElementNS(t,"svg");return r.setAttribute("class",`${e}-footer-icon-arrow-left`),r.setAttribute("viewBox","0 0 20 20"),r.innerHTML=`<g clip-path="url(#clip0_11800_99864)">
<path fill-rule="evenodd" clip-rule="evenodd" d="M11.5283 4.86182L12.4711 5.80463L8.22849 10.0473L12.4711 14.2899L11.5283 15.2327L6.34287 10.0473L11.5283 4.86182Z" class="arrow" />
</g>
<defs>
<clipPath id="clip0_11800_99864">
<rect width="16" height="16" fill="white" transform="translate(2 2)"/>
</clipPath>
</defs>`,r}function it(e){const t="http://www.w3.org/2000/svg",r=document.createElementNS(t,"svg");return r.setAttribute("class",`${e}-footer-icon-arrow-right`),r.setAttribute("viewBox","0 0 20 20"),r.innerHTML=`<g clip-path="url(#clip0_11800_99870)">
<path fill-rule="evenodd" clip-rule="evenodd" d="M8.1377 4.86182L7.19489 5.80463L11.4375 10.0473L7.19489 14.2899L8.1377 15.2327L13.3231 10.0473L8.1377 4.86182Z" class="arrow" />
</g>
<defs>
<clipPath id="clip0_11800_99870">
<rect width="16" height="16" fill="white" transform="translate(2 2)"/>
</clipPath>
</defs>`,r}class st{constructor(t,r,a){this.context=t,this.onPrev=r,this.onNext=a,this.sideEffect=new X,this.role=q(2),this.text=q("..."),this.$footer=I("div"),this.$btnLeft=I("button"),this.$btnRight=I("button"),this.$span=I("span"),this.box=t.getBox(),G(this.$footer,this.$btnLeft),G(this.$footer,this.$span),G(this.$footer,this.$btnRight),V(this.$footer,"class","app-talkative-footer"),V(this.$btnLeft,"class","app-talkative-btn app-talkative-btn-left"),V(this.$btnRight,"class","app-talkative-btn app-talkative-btn-right"),V(this.$span,"class","app-talkative-page"),this.$btnLeft.appendChild(nt("app-talkative")),this.$btnRight.appendChild(it("app-talkative")),this.$btnLeft.addEventListener("click",this.onPrev),this.$btnRight.addEventListener("click",this.onNext)}_on_update_role(t){this.$btnLeft.disabled=t===2,this.$btnRight.disabled=t===2,this.$footer.classList.toggle("owner",t===0)}_on_update_text(t){this.$span.textContent=t}mount(){return this.box.mountFooter(this.$footer),this.sideEffect.addDisposer(this.role.subscribe(this._on_update_role.bind(this))),this.sideEffect.addDisposer(this.text.subscribe(this._on_update_text.bind(this))),this.destroy.bind(this)}destroy(){this.sideEffect.flushAll(),oe(this.$footer)}}function at({context:e,logger:t,...r}){const a=new X,o={onPagenum({totalPages:u}){e.getIsWritable()&&u&&e.storage.setState({pageNum:u})},onLoadComplete(u){r.onRatioChanged(u.coursewareRatio),e.getIsWritable()&&u.totalPages&&e.storage.setState({pageNum:u.totalPages});const{page:l,lastMsg:v}=e.storage.state;v&&r.postMessage(v),r.postMessage(JSON.stringify({method:"onJumpPage",toPage:l}))},onLocalMessage(u){e.getIsWritable()&&r!=null&&r.onLocalMessage&&r.onLocalMessage(e.appId,u)},onFileMessage(u){if(e.getIsWritable()){e.dispatchMagixEvent("broadcast",JSON.stringify(u));const l=JSON.stringify({...u,isRestore:!0});e.storage.setState({lastMsg:l})}}};return a.addDisposer(e.addMagixEventListener("broadcast",({payload:u})=>{console.log(u),r.postMessage(u)})),a.addEventListener(window,"message",u=>{if(!!r.isSentBySelf(u.source))if(typeof u.data=="string")try{const l=JSON.parse(u.data);if(typeof l=="object"&&l!==null){const v=o[l.method];v?v(l):t.warn("unknown message",l)}}catch(l){t.warn("error when parsing message",l)}else typeof u.data=="object"&&u.data!==null&&t.log("unhandled permission command",u.data)}),a.flushAll.bind(a)}const ot=350,ct={kind:"Talkative",setup(e){e.storage.ensureState({src:"https://example.org",uid:"",page:1,pageNum:1,lastMsg:""});const t=new Set(["clicker"]),{onLocalMessage:r,debug:a,setReceivePostMessageFun:o,getInfoSync:u}=e.getAppOptions()||{},l=new _e("Talkative",a),{uid:v,userId:y,nickName:m,cursorName:S}=$e(e),b=new X,$=e.getView(),p=e.getRoom();l.log("my uid",v);let R=()=>{};const W=n=>t.has(n),w=n=>{if(!$)l.warn("SetPage: page api is only available with 'scenePath' options enabled.");else{const i=e.getInitScenePath();if(typeof n=="string"&&e.getIsWritable()&&i&&p){const s=[i,n].join("/");p.scenePathType(s)==="none"&&p.putScenes(i,[{name:n}]),e.setScenePath(s),e.updateAttributes(["page"],n)}}},F=()=>{const{page:n}=e.storage.state;e.getIsWritable()&&n>1&&e.storage.setState({page:n-1})},O=()=>{const{page:n,pageNum:i}=e.storage.state;e.getIsWritable()&&n<i&&e.storage.setState({page:n+1})},g=new rt(e),E=new st(e,F,O),M=g.postMessage.bind(g);o==null||o(M),b.addDisposer(at({context:e,logger:l,postMessage:M,onRatioChanged:g.ratio.set.bind(g.ratio),isSentBySelf:n=>n===g.$iframe.contentWindow,onLocalMessage:r})),b.addDisposer(e.storage.addStateChangedListener(()=>{const n=e.storage.state.uid===v?0:2;g.role.set(n),E.role.set(n);const{page:i,pageNum:s}=e.storage.state;M(JSON.stringify({method:"onJumpPage",toPage:i})),E.text.set(`${i}/${s}`)})),p&&b.add(()=>{const n=i=>{i.memberState&&R(W(i.memberState.currentApplianceName))};return p.callbacks.on("onRoomStateChanged",n),()=>p.callbacks.off("onRoomStateChanged",n)});const H=async()=>{b.addDisposer(g.mount()),b.addDisposer(E.mount());const n=e.storage.state.uid===v?0:2,i=await(u==null?void 0:u(JSON.stringify({method:"getTalkActiveUrlParams"}))),s=`userid=${y}&role=${n}&name=${(S==null?void 0:S.length)>0?S:m}${i}`;g.$iframe.src=Be(e.storage.state.src,s),g.role.set(n),E.role.set(n);const{page:c,pageNum:d}=e.storage.state;if(E.text.set(`${c}/${d}`),w(`${c}`),$){const h=document.createElement("div");Object.assign(h.style,{width:"100%",height:"100%",position:"absolute",top:0,left:0,overflow:"hidden"}),g.$content.appendChild(h),e.mountView(h),$.disableCameraTransform=!0,b.add(()=>{const f=()=>{const k=g.$content.getBoundingClientRect().height/ot;$.moveCamera({scale:k,animationMode:"immediately"})},z=new ResizeObserver(f);return z.observe(g.$content),()=>z.disconnect()}),R=f=>{h.style.pointerEvents=f?"none":"auto"},p!=null&&p.state.memberState.currentApplianceName&&R(W(p==null?void 0:p.state.memberState.currentApplianceName))}};if(e.storage.state.uid)ce.then(H);else{const n=b.addDisposer(e.storage.addStateChangedListener(()=>{e.storage.state.uid&&(b.flush(n),H())}));e.isAddApp&&(l.log("no teacher's uid, setting myself..."),e.storage.setState({uid:v}))}e.emitter.on("destroy",()=>{l.log("destroy"),b.flushAll()})}};return x.default=ct,Object.defineProperties(x,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}}),x}({});
//# sourceMappingURL=main.iife.js.map
